<Window x:Class="SWTools.WPF.AddTaskWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SWTools.WPF"
        xmlns:controls="clr-namespace:SWTools.WPF.Controls"
        xmlns:viewmodel="clr-namespace:SWTools.ViewModel;assembly=SWTools.ViewModel"
        mc:Ignorable="d"
        Title="添加下载任务"
        Height="600" Width="820"
        MinHeight="400" MinWidth="800"
        Background="{StaticResource BhDefault}" ThemeMode="Light"
        WindowStartupLocation="CenterOwner" ShowInTaskbar="False"
        RenderOptions.BitmapScalingMode="HighQuality"
        Closing="Window_Closing">
    <Window.DataContext>
        <viewmodel:AddTaskWindow/>
    </Window.DataContext>
    
    <!--解析列表的右键菜单-->
    <Window.Resources>
        <ContextMenu x:Key="ContextMenu">
            <MenuItem x:Name="MenuRemove" Click="MenuRemove_Click">
                <MenuItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                   Text="&#xE711;" VerticalAlignment="Center" Margin="0 0 10 0"/>
                        <TextBlock Text="移除"/>
                    </StackPanel>
                </MenuItem.Header>
            </MenuItem>
        </ContextMenu>
    </Window.Resources>

    <DockPanel>
        <!--底栏-->
        <DockPanel DockPanel.Dock="Bottom" LastChildFill="False" Background="{StaticResource BhGray}">
            <controls:IconButtonAccent x:Name="BtnOk" Click="BtnOk_Click"
                Text="确定" Icon="&#xE8FB;" DockPanel.Dock="Right" Margin="10 10 20 10"/>
            <TextBlock DockPanel.Dock="Left" VerticalAlignment="Center" Margin="20 10 10 10"
                       Text="提示：输入要下载的 ID → 解析信息 → 补充缺失的信息（如有）→ 完成"/>
        </DockPanel>
        <Separator DockPanel.Dock="Bottom" BorderBrush="{StaticResource BhBorder}" Margin = "0"/>
        <ProgressBar x:Name="ProgressBar" DockPanel.Dock="Bottom" IsIndeterminate="{Binding IsIndeterminate}"
                     Background="Transparent"/>

        <DockPanel Margin="20 0 20 10">
            <!--物品ID输入-->
            <DockPanel Margin="0 20 10 0" Width="300" DockPanel.Dock="Left">
                <TextBlock Text="在下面输入要下载的物品 ID（一行一个 ID）" DockPanel.Dock="Top"/>
                <DockPanel LastChildFill="False" DockPanel.Dock="Bottom">
                    <controls:IconButtonAccent x:Name="BtnParse" Click="BtnParse_Click"
                        Text="解析信息" Icon="&#xF6FA;" DockPanel.Dock="Right" IsEnabled="{Binding IsBtnParseEnable}" Loaded="BtnParse_Loaded"/>
                    <controls:IconButton x:Name="BtnHelpItem" Click="BtnHelpItem_Click"
                        Text="什么是物品 ID" Icon="&#xE897;" DockPanel.Dock="Left"/>
                </DockPanel>
                <TextBox TextWrapping="Wrap" AcceptsReturn="True" Margin="0 10 0 5" VerticalScrollBarVisibility="Auto"
                          x:Name="TextBox" Text="{Binding ItemsToDownload}" TextChanged="TextBox_TextChanged"/>
            </DockPanel>
            <Separator DockPanel.Dock="Left" BorderBrush="#d4d4d4" Margin="0 20 0 20"/>
            <!--解析列表-->
            <DockPanel Margin="10 10 0 0">
                <DockPanel DockPanel.Dock="Top">
                    <controls:IconButton x:Name="BtnParseRetry" Click="BtnParseRetry_Click"
                        Text="重新解析" Icon="&#xE72C;" DockPanel.Dock="Right"/>
                    <TextBlock Text="解析列表" VerticalAlignment="Center"/>
                </DockPanel>
                <DockPanel DockPanel.Dock="Bottom">
                    <TextBlock Text="App ID：" VerticalAlignment="Center"/>
                    <controls:IconButton x:Name="BtnHelpApp" Click="BtnHelpApp_Click"
                        Text="什么是 App ID" Icon="&#xE897;" DockPanel.Dock="Right" Margin="5 0 0 0"/>
                    <controls:IconButton x:Name="BtnEdit" Click="BtnEdit_Click" IsEnabled="{Binding IsBtnEditEnable}"
                        Text="修改信息" Icon="&#xE70F;" DockPanel.Dock="Right" Margin="5 0 0 0"/>
                    <TextBox x:Name="TextBoxAppId" Height="35" VerticalAlignment="Center" Margin="5 0 5 0" DockPanel.Dock="Left"/>
                </DockPanel>
                <ListView ItemsSource="{Binding DisplayItems}" FontSize="13" Background="{StaticResource BhLight}" Margin="0 5 0 5"
                          SelectionChanged="ListView_SelectionChanged" x:Name="ListView">
                    <!--右键菜单-->
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="ContextMenu" Value="{StaticResource ContextMenu}"/>
                            <Setter Property="Height" Value="30"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                    <!--列表-->
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="名称" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding ItemName}" ToolTip="{Binding ItemName}" 
                                            ToolTipService.InitialShowDelay="300" Foreground="{Binding Brush}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="适用的 App" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding AppName}" ToolTip="{Binding AppName}"
                                            ToolTipService.InitialShowDelay="300" Foreground="{Binding Brush}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="解析状态" Width="100">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding State}" Foreground="{Binding Brush}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </DockPanel>
        </DockPanel>
    </DockPanel>
</Window>
