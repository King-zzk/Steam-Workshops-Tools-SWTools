<Window x:Class="SWTools.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SWTools.WPF"
        xmlns:controls="clr-namespace:SWTools.WPF.Controls"
        xmlns:viewmodel="clr-namespace:SWTools.ViewModel;assembly=SWTools.ViewModel"
        mc:Ignorable="d"
        Title="Steam Workshop Tools (SWTools)" 
        Height="600" Width="900"
        MinHeight="400" MinWidth="800"
        Background="{StaticResource BgDefault}" ThemeMode="Light"
        WindowStartupLocation="CenterScreen"
        RenderOptions.BitmapScalingMode="HighQuality"
        Closed="Window_Closed" Loaded="Window_Loaded">
    <Window.DataContext>
        <viewmodel:MainWindow/>
    </Window.DataContext>
    
    <!--下载列表的右键菜单-->
    <Window.Resources>
        <ContextMenu x:Key="ContextMenu">
            <MenuItem x:Name="MenuRemove" Click="MenuRemove_Click">
                <MenuItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="{StaticResource SymbolThemeFontFamily}" 
                               Text="&#xE711;" VerticalAlignment="Center" Margin="0 0 10 0"/>
                        <TextBlock Text="移除"/>
                    </StackPanel>
                </MenuItem.Header>
            </MenuItem>
            <MenuItem x:Name="MenuOpenFolder" Click="MenuOpenFolder_Click">
                <MenuItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                Text="&#xE838;" VerticalAlignment="Center" Margin="0 0 10 0"/>
                        <TextBlock Text="打开文件夹"/>
                    </StackPanel>
                </MenuItem.Header>
            </MenuItem>
            <MenuItem x:Name="MenuRetry" Click="MenuRetry_Click">
                <MenuItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                Text="&#xE72C;" VerticalAlignment="Center" Margin="0 0 10 0"/>
                        <TextBlock Text="重新下载"/>
                    </StackPanel>
                </MenuItem.Header>
            </MenuItem>
            <MenuItem x:Name="MenuCopy" Click="MenuCopy_Click">
                <MenuItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="{StaticResource SymbolThemeFontFamily}" 
                    Text="&#xE8C8;" VerticalAlignment="Center" Margin="0 0 10 0"/>
                        <TextBlock Text="复制物品 ID"/>
                    </StackPanel>
                </MenuItem.Header>
            </MenuItem>
        </ContextMenu>
    </Window.Resources>

    <DockPanel>
        <!--顶栏-->
        <DockPanel LastChildFill="False" DockPanel.Dock="Top" Margin="10 10 10 10">
            <Image Height="40" Margin="0 0 5 0" VerticalAlignment="Center" Source="Resources/icon.png" />
            <controls:IconButton x:Name="BtnAddTask" Click="BtnAddTask_Click"
                Text="添加下载任务" Icon="&#xE710;" DockPanel.Dock="Left" Margin="5 0 5 0" IsEnabled="{Binding IsBtnAddTaskEnable}"/>
            <controls:IconButtonAccent x:Name="BtnStart" Click="BtnStart_Click" IsEnabled="{Binding IsBtnStartEnable}"
                Text="下载全部" Icon="&#xE768;" DockPanel.Dock="Left" Margin="5 0 5 0"/>
            <controls:IconButton x:Name="BtnStop" IsEnabled="{Binding IsBtnStopEnable}"
                Text="暂停" Icon="&#xE769;" DockPanel.Dock="Left" Margin="5 0 5 0" Click="BtnStop_Click"/>
            <controls:IconButton x:Name="BtnRemoveAll"
                Text="清空列表" Icon="&#xE74D;" DockPanel.Dock="Left" Margin="5 0 5 0" IsEnabled="{Binding IsBtnRemoveAllEnable}"
                ToolTip="清空已下载物品的列表，这不会删除物品文件" ToolTipService.InitialShowDelay="100" Click="BtnRemoveAll_Click"/>
            <controls:IconButton x:Name="BtnMore" Click="BtnMore_Click"
                Text="更多" Icon="&#xE712;" DockPanel.Dock="Right" Margin="5 0 5 0"/>
        </DockPanel>
        <Separator BorderBrush="#d4d4d4"  DockPanel.Dock="Top" Margin="0"/>
        
        <!--底栏-->
        <DockPanel DockPanel.Dock="Bottom" LastChildFill="False" Background="{StaticResource BgGray}">
            <controls:IconButton x:Name="BtnLog" Click="BtnLog_Click"
                Text="打开日志窗口" Icon="&#xE8A4;" DockPanel.Dock="Right" Margin="5 10 10 10"/>
            <TextBlock DockPanel.Dock="Left" VerticalAlignment="Center" Margin="20 10 10 10" Text="{Binding StatusText}"/>
        </DockPanel>
        <Separator DockPanel.Dock="Bottom" BorderBrush="#d4d4d4"/>
        <ProgressBar x:Name="ProgressBar" DockPanel.Dock="Bottom" IsIndeterminate="{Binding IsIndeterminate}"
             Background="Transparent"/>
        
        <!--下载列表-->
        <ListView ItemsSource="{Binding DisplayItems}" FontSize="13" Background="{StaticResource BgLight}">
            <!--右键菜单-->
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="ContextMenu" Value="{StaticResource ContextMenu}"/>
                </Style>
            </ListView.ItemContainerStyle>
            <!--列表-->
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="" Width="60">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Image VerticalAlignment="Center" HorizontalAlignment="Left" Margin="5 5 5 5"
                                       Height="40" Source="{Binding PreviewImage}" ToolTipService.InitialShowDelay="300">
                                    <ToolTipService.ToolTip>
                                        <Image VerticalAlignment="Center" HorizontalAlignment="Left" Margin="0"
                                        Height="200" Source="{Binding PreviewImage}" />
                                    </ToolTipService.ToolTip>
                                </Image>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="名称" Width="280">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding ItemName}" ToolTip="{Binding ItemName}" 
                                           ToolTipService.InitialShowDelay="300"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="适用的 App" Width="170">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding AppName}" ToolTip="{Binding AppName}"
                                           ToolTipService.InitialShowDelay="300"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="大小" Width="100" DisplayMemberBinding="{Binding ItemSize}"/>
                    <GridViewColumn Header="状态" Width="250">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding State}" ToolTip="{Binding State}"
                                    ToolTipService.InitialShowDelay="300"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>
    </DockPanel>

</Window>
